<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Product Management - Shoes Kampany</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap4.min.css" />
  <style>
    body { font-family: 'Roboto', sans-serif; display: flex; min-height: 100vh; margin: 0; }
    #sidebar {
      width: 250px;
      background-color: #2c3e50;
      color: white;
      padding: 0;
      display: flex; 
      flex-direction: column; 
      position: fixed; 
      top: 0; 
      left: 0; 
      bottom: 0; 
      overflow-y: auto; 
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    }
    #sidebar-header {
      background-color: #1c2833; 
      padding: 20px; 
      text-align: center;
    }
    #sidebar h1 { font-size: 1.8rem; margin: 0; font-weight: 500; }
    #sidebar h2 { font-size: 1.2rem; margin: 10px 0 0; font-weight: 400; opacity: 0.8; }
    #sidebar ul { list-style: none; padding: 0; flex-grow: 1; margin: 0; }
    #sidebar li { margin: 0; }
    #sidebar a {
      color: #ecf0f1; 
      text-decoration: none; 
      display: flex; 
      align-items: center; 
      padding: 15px 20px; 
      transition: background-color 0.3s, color 0.3s; 
      font-size: 14px; 
      font-weight: 500;
    }
    #sidebar a:hover { background-color: #34495e; color: #fff; }
    #sidebar a.active { background-color: #e74c3c; color: #fff; }
    #sidebar .material-icons { margin-right: 15px; font-size: 20px; }
    #content { flex: 1; padding: 30px; background-color: #ecf0f1; margin-left: 250px; }
    .table-container {
      overflow-x: auto;
      max-height: 500px;
      margin-bottom: 30px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    table { width: 100%; border-collapse: separate; border-spacing: 0; }
    th, td { text-align: left; padding: 15px; border-bottom: 1px solid #e0e0e0; white-space: nowrap; }
    th { background-color: #344955; color: white; font-weight: 500; position: sticky; top: 0; z-index: 1; }
    tbody tr:hover { background-color: #f0f0f0; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-sm .material-icons { font-size: 18px; }
    #sidebarToggle {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      background-color: #FF5722;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .navbar { box-shadow: none; border-radius: 0; }
    .navbar-brand { font-weight: bold; }
    .breadcrumb { background-color: transparent; padding: 0; margin-bottom: 20px; font-size: 14px; }
    .breadcrumb-item a { color: #3498db; text-decoration: none; }
    .breadcrumb-item a:hover { text-decoration: underline; }
    #addBtn {
      font-family: 'Roboto', sans-serif;
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 10px 15px;
      background-color: #E74C3C;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      font-weight: 500;
      font-size: 14px;
    }
    #addBtn:hover { background-color: #C0392B; }
    #addBtn .material-icons { margin-right: 5px; }

    @media (max-width: 768px) {
      #sidebar { transform: translateX(-100%); }
      #sidebar.active { transform: translateX(0); }
      #content { margin-left: 0; width: 100%; }
      #sidebarToggle { display: block; }
      table { font-size: 14px; }
      th, td { padding: 10px; }
    }

    .status-listed { color: #28a745; font-weight: bold; }
    .status-unlisted { color: #dc3545; font-weight: bold; }
    .btn-delete { color: #dc3545; }
    .btn-visibility { color: #28a745; }
    .btn-unlist { color: #dc3545; }
  </style>
</head>
<body>
  <nav id="sidebar">
    <div id="sidebar-header">
      <h1>Shoes Kampany</h1>
      <h2>Admin</h2>
    </div>
    <ul>
      <li><a href="/admin/dashboard" ><i class="material-icons">dashboard</i> Dashboard</a></li>
      <li><a href="/admin/category"><i class="material-icons">category</i> Category</a></li>
      <li><a href="/admin/products" class="active"><i class="material-icons">shopping_bag</i> Products</a></li>
      <li><a href="/admin/viewOrders"><i class="material-icons">shopping_cart</i> Orders</a></li>
      <li><a href="/admin/sales-report"><i class="material-icons">bar_chart</i> Sales Report</a></li>
      <li><a href="/admin/userside"><i class="material-icons">group</i> Users</a></li>
      <li><a href="/admin/couponmanage"><i class="material-icons">loyalty</i> Coupons</a></li>
      <li><a href="/admin/offermanage" ><i class="material-icons">local_offer</i> Offers</a></li>
      <li><a href="/admin/adminLogout"><i class="material-icons">logout</i> Logout</a></li>
    </ul>
  </nav>

  <div id="content">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Products</li>
      </ol>
    </nav>

    <h1>All Products</h1>

    <a href="/admin/addproduct" id="addBtn">
      <i class="material-icons">add</i> Add Product
    </a>
    <div class="table-container">
      <div class="sorting-controls">
        <form method="GET" action="/admin/products">
          <label for="sortField">Sort by:</label>
          <select name="sortField" id="sortField">
            <option value="product_name" <%= sortField === 'product_name' ? 'selected' : '' %>>Name</option>
            <option value="price" <%= sortField === 'price' ? 'selected' : '' %>>Price</option>
            <option value="stock" min="0" <%= sortField === 'stock' ? 'selected' : '' %>>Stock</option>
          </select>
          <label for="sortOrder">Order:</label>
          <select name="sortOrder" id="sortOrder">
            <option value="asc" <%= sortOrder === 1 ? 'selected' : '' %>>Ascending</option>
            <option value="desc" <%= sortOrder === -1 ? 'selected' : '' %>>Descending</option>
          </select>
          <button type="submit" class="btn btn-primary">Sort</button>
        </form>
      </div>
      <table class="table" id="usertable">
        <thead class="thead-dark">
          <tr class="bg-dark text-light">
            <th>ID</th>
            <th>Image</th>
            <th>Name</th>
            <th>Price</th>
            <th>Stock</th>
            <th>List</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% products.forEach((pdt, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td>
                <% pdt.images.forEach(image => { %>
                  <img class="object-fit-cover" src="/<%= image %>" alt="" style="width: 60px; height: 60px; object-fit: cover; margin-right: 5px;">
                <% }) %>
              </td>
              <td><%= pdt.product_name %></td>
              <td> â‚¹ <%= pdt.price %></td>
              <td><%= pdt.stock %></td>
              <td class="<%= pdt.list === 'listed' ? 'status-listed' : 'status-unlisted' %>"><%= pdt.list %></td>
              <td>
                <a href="/admin/productedit/<%= pdt._id %>" class="btn btn-primary">
                  <span class="material-icons">edit</span>
                </a>
                <a class="btn border-shadow shadow delete btn-delete" data-id="<%= pdt._id %>">
                  <span class="material-icons">delete</span>
                </a>
                <% if (pdt.list === 'listed') { %>
                  <a href="/admin/productlist?id=<%= pdt._id %>" class="btn border-shadow shadow btn-unlist" data-id="<%= pdt._id %>">
                    <span class="material-icons">visibility_off</span>
                  </a>
                <% } else { %>
                  <a href="/admin/productlist?id=<%= pdt._id %>" class="btn border-shadow shadow btn-visibility" data-id="<%= pdt._id %>">
                    <span class="material-icons">visibility</span>
                  </a>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    
  </div>

  <button id="sidebarToggle"><i class="material-icons">menu</i></button>

  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    $(document).ready(function() {
      var table = $('#usertable').DataTable({
        paging: false,
        info: false,
        searching: false,
        drawCallback: function() {
          // Prevents table jerk on actions by maintaining table height
          var tableHeight = $('.table-container').height();
          $('.table-container').css('min-height', tableHeight + 'px');
        }
      });

      $('#sidebarToggle').click(function() {
        $('#sidebar').toggleClass('active');
      });

      $('.delete').click(function() {
        var id = $(this).data('id');
        Swal.fire({
          title: 'Are you sure?',
          text: 'Do you really want to delete this record?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, delete it!',
          cancelButtonText: 'No, cancel!',
          reverseButtons: true
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: `/admin/productDelete/${id}`,
              method: 'DELETE'
            }).done(function(response) {
              Swal.fire('Deleted!', 'Record deleted successfully.', 'success').then(() => {
                table.row($(this).parents('tr')).remove().draw();
                location.reload();
              });
            });
          }
        });
      });

      // $('.btn-unlist, .btn-visibility').click(function(e) {
      //   e.preventDefault();
      //   var id = $(this).data('id'); // Updated to use data-id attribute
      //   var action = $(this).hasClass('btn-unlist') ? 'unlist' : 'list';
      //   var confirmText = action === 'unlist' ? 'unlist this product?' : 'list this product?';
      //   var buttonText = action === 'unlist' ? 'Yes, unlist it!' : 'Yes, list it!';

      //   Swal.fire({
      //     title: 'Are you sure?',
      //     text: 'Do you really want to ' + confirmText,
      //     icon: 'warning',
      //     showCancelButton: true,
      //     confirmButtonText: buttonText,
      //     cancelButtonText: 'No, cancel!',
      //     reverseButtons: true
      //   }).then((result) => {
      //     if (result.isConfirmed) {
      //       $.ajax({
      //         url: `/admin/productlist?id=${id}`,
      //         method: 'POST'
      //       }).done(function(response) {
      //         Swal.fire('Updated!', 'Product status updated successfully.', 'success').then(() => {
      //           location.reload();
      //         });
      //       });
      //     }
      //   });
      // });
    });
</script>

</body>
</html>
    