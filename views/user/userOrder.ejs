	<!DOCTYPE html>
	<html lang="en">

	<head>
		<title>User Profile</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Font Awesome CSS -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5/6en8XCp+HHAAK5GSLf2xlYtvJ8U2Q4U+9cuEnJoa3" crossorigin="anonymous">
		
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">

		<!-- Bootstrap Icons -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">

		<!-- Other CSS links -->
		<link rel="stylesheet" type="text/css" href="css/util.css">
		<link rel="stylesheet" type="text/css" href="css/main.css">

		<!-- SweetAlert CSS -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

		<!-- Additional CSS links -->
		<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
		<link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.min.css">
		<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
		<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
		<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
		<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
		<link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

		<!-- Favicon -->
		<link rel="icon" type="image/png" href="images/icons/favicon.png">

		<style>
			body {
				font-family: 'Times New Roman', Times, serif sans-serif;
				background-color: #f8f9fa;
				color: #333;
			}

			.profile {
				text-align: center;
				margin-bottom: 20px;
			}

			.profile img {
				width: 100px;
				height: 100px;
				border-radius: 50%;
				margin-bottom: 10px;
			}

			.profile h5 {
				font-weight: bold;
				margin: 0;
				font-size: 1.2rem;
			}

			.sidebar {
				background-color: black;
				padding: 20px;
				border-right: 2px solid blue;
				min-height: 100vh;
				color: #fff;
			}

			@media (max-width: 767px) {
				.sidebar {
					min-height: 40vh;
				}
			}

			.sidebar ul {
				list-style-type: none;
				padding: 0;
				margin: 0;
			}

			.sidebar ul li {
				margin-bottom: 10px;
			}

			.sidebar ul li a {
				text-decoration: none;
				color: #fff;
				font-size: 1.1rem;
			}

			.sidebar ul li a:hover {
				color: #cce0ff;
			}

			.content {
				padding: 20px;
			}

			.tab-content {
				padding: 20px;
			}

		

			.table {
				width: 100%;
				border-collapse: collapse;
				background-color: #fff;
				border-radius: 5px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			}

			.table th,
			.table td {
				border: 1px solid #dee2e6;
				padding: .75rem;
				text-align: left;
			}

			.table th {
				background-color: #f2f2f2;
			}

			.nav-tabs {
				background-color: #f8f9fa;
				border-bottom: 1px solid #dee2e6;
				border-radius: 5px;
			}

			.nav-tabs .nav-item {
				margin-bottom: -1px;
			}

			.nav-tabs .nav-link {
				border: 1px solid transparent;
				border-radius: 5px 5px 0 0;
				color: #333;
				background-color: transparent;
			}

			.nav-tabs .nav-link.active {
				border-color: #dee2e6 #dee2e6 #f8f9fa;
				background-color: #fff;
				color: #000;
			}

			.nav-tabs .nav-link:hover {
				border-color: #dee2e6 #dee2e6 #fff;
				background-color: #f8f9fa;
				color: #000;
			}

			.tab-pane {
				background-color: #fff;
				border-radius: 5px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			}

			.object-fit-cover {
				object-fit: cover;
				height: 100px;
				width: 100px;
			}

			.pagination-container {
				display: flex;
				justify-content: center;
				margin-top: 10px;
			}

			.pagination {
				display: flex;
				gap: 10px;
			}

			.page-btn {
				padding: 5px 10px;
				border: 1px solid #ccc;
				background-color: #f0f0f0;
				cursor: pointer;
			}

			.page-btn:hover {
				background-color: grey;
			}
		</style>

	<style>
		.order-status-alert {
			color: black; /* White text for better contrast */
			background-color:yellow; /* Orange background for alert */
			font-weight: bold;
			font-size: 1em; /* Larger font size */
			padding: 1px; /* More padding for better readability */
			border-radius: 5px; /* Rounded corners */
			display: inline-flex; /* To align the icon and text */
			align-items: center; /* Vertically align icon and text */
			margin: 5px 0; /* Margin for spacing */
			animation: pulse 1.5s infinite; /* Pulsing animation */
		}
		
		.order-status-alert i {
			margin-right: 8px; /* Space between icon and text */
		}
		
		@keyframes pulse {
			0% { box-shadow: 0 0 5px rgba(255, 165, 0, 0.7); }
			50% { box-shadow: 0 0 20px rgba(255, 165, 0, 1); }
			100% { box-shadow: 0 0 5px rgba(255, 165, 0, 0.7); }
		}
		</style>


	<style>


	.payment-status-completed {
			font-weight: bold;
			color: green;
			animation: blink-animation 2s infinite; /* Adjust duration here */
		}

		.payment-status-pending {
			font-weight: bold;
			color: red;
		}

		.payment-status-shipped {
			font-weight: bold;
			color: #ffcc00; /* Brighter shade of yellow */
		}

		@keyframes blink-animation {
			0% { opacity: 1; }
			50% { opacity: 0; }
			100% { opacity: 1; }





	}

		.payment-status-alert {
			color: black; /* White text for better contrast */
			background-color: yellow; /* Red background for alert */
			font-weight: bold;
			font-size: 1em; /* Larger font size */
			padding: 1px; /* More padding for better readability */
			border-radius: 1px; /* Rounded corners */
			display: inline-flex; /* To align the icon and text */
			align-items: center; /* Vertically align icon and text */
			margin: 5px 0; /* Margin for spacing */
			animation: pulse 1.5s infinite; /* Pulsing animation */
		}
		
		.payment-status-alert i {
			margin-right: 8px; /* Space between icon and text */
		}
		
		@keyframes pulse {
			0% { box-shadow: 0 0 1px rgba(255, 0, 0, 0.7); }
			50% { box-shadow: 0 0 3px rgba(255, 0, 0, 1); }
			100% { box-shadow: 0 0 5px rgba(255, 0, 0, 0.7); }
		}
		</style>
		
		
	</head>

	<body class="animsition" style="margin: 0px;">

		<!-- Header -->
		<header class="header-v4">
			<!-- Header desktop -->
			<div class="container-menu-desktop">
				<!-- Topbar -->
				<div class="top-bar">
					<div class="content-topbar flex-sb-m h-full container">
						<div class="left-top-bar">
							Free shipping for standard order over $100
						</div>

						<div class="right-top-bar flex-w h-full">

							<a href="#" class="flex-c-m trans-04 p-lr-25">
								My Account
							</a>
						</div>
					</div>
				</div>

				<div class="wrap-menu-desktop how-shadow1">
					<nav class="limiter-menu-desktop container">

						<!-- Logo desktop -->
						<a href="#" class="logo">
							<img src="images/icons/logo-01.png" alt="IMG-LOGO">
						</a>

						<!-- Menu desktop -->
						<div class="menu-desktop">
							<ul class="main-menu">
								<li>
									<a href="/">Home</a>
								</li>

								<li>
									<a href="/shop">Shop</a>
								</li>

							</ul>
						</div>

						<!-- Icon header -->
						<div class="wrap-icon-header flex-w flex-r-m">
							<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
								<i class="zmdi zmdi-search"></i>
							</div>

							<div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-cart"
								data-notify="">
								<i class="zmdi zmdi-shopping-cart"></i>
							</div>

							<a href="#" class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti"
								data-notify="0">
								<i class="zmdi zmdi-favorite-outline"></i>
							</a>
						</div>
					</nav>
				</div>
			</div>

			<!-- Header Mobile -->
			<div class="wrap-header-mobile">
				<!-- Logo moblie -->
				<div class="logo-mobile">
					<a href="index.html"><img src="images/icons/logo-01.png" alt="IMG-LOGO"></a>
				</div>

				<!-- Icon header -->
				<div class="wrap-icon-header flex-w flex-r-m m-r-15">
					<div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 js-show-modal-search">
						<i class="zmdi zmdi-search"></i>
					</div>

					<div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti js-show-cart"
						data-notify="2">
						<i class="zmdi zmdi-shopping-cart"></i>
					</div>

					<a href="#" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti"
						data-notify="0">
						<i class="zmdi zmdi-favorite-outline"></i>
					</a>
				</div>


				<!-- Button show menu -->
				<div class="btn-show-menu-mobile hamburger hamburger--squeeze">
					<span class="hamburger-box">
						<span class="hamburger-inner"></span>
					</span>
				</div>
			</div>


			<!-- Menu Mobile -->
			<div class="menu-mobile">
				<ul class="topbar-mobile">
					<li>
						<div class="left-top-bar">
							Free shipping for standard order over $100
						</div>
					</li>

					<li>
						<div class="right-top-bar flex-w h-full">

							<a href="#" class="flex-c-m p-lr-10 trans-04">
								My Account


						</div>
					</li>
				</ul>

				<ul class="main-menu-m">
					<li>
						<a href="index.html">Home</a>

						<span class="arrow-main-menu-m">
							<i class="fa fa-angle-right" aria-hidden="true"></i>
						</span>
					</li>

					<li>
						<a href="product.html">Shop</a>
					</li>

				</ul>
			</div>

		
			
		</header>

		<!-- Cart -->
		<div class="wrap-header-cart js-panel-cart">
			<div class="s-full js-hide-cart"></div>

			<div class="header-cart flex-col-l p-l-65 p-r-25">
				<div class="header-cart-title flex-w flex-sb-m p-b-8">
					<span class="mtext-103 cl2">
						Your Cart
					</span>

					<div class="fs-35 lh-10 cl2 p-lr-5 pointer hov-cl1 trans-04 js-hide-cart">
						<i class="zmdi zmdi-close"></i>
					</div>
				</div>

				<div class="header-cart-content flex-w js-pscroll">
					<ul class="header-cart-wrapitem w-full">


						<li class="header-cart-item flex-w flex-t m-b-12">
							<div class="header-cart-item-img">
								<img src="" alt="IMG">
							</div>
							<div class="header-cart-item-txt p-t-8">
								<a href="#" class="header-cart-item-name m-b-18 hov-cl1 trans-04">

								</a>
								<span class="header-cart-item-info">&#x20a8; </span>
							</div>
						</li>


						<li class="header-cart-item flex-w flex-t m-b-12">
							Cart is empty.....
						</li>



					</ul>


					<div class="header-cart-buttons flex-w w-full">
						<a href="/shoping-cart"
							class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-r-8 m-b-10">
							View Cart
						</a>

						<a href="shoping-cart.html"
							class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-b-10">
							Check Out
						</a>
					</div>
				</div>
			</div>
		</div>
		</div>


		<!-- breadcrumb -->
		<div class="container">
			<div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
				<a href="index.html" class="stext-109 cl8 hov-cl1 trans-04">
					Home
					<i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
				</a>

				<span class="stext-109 cl4">
					addAddress
				</span>
			</div>
		</div>


		<!-- Sidebar content -->
	<!-- Sidebar content -->
	<div class="container">
		<div class="row">
			<div class="col-md-3">
				<div class="osahan-account-page-left shadow-sm bg-white h-100">
					<div class="border-bottom p-4">
						<div class="osahan-user text-center">
							<div class="osahan-user-media">
								<img class="mb-3 rounded-pill shadow-sm mt-1" src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="User Image">
								<div class="osahan-user-media-body">
									<h6 class="mb-2"><%= user.firstname +" "+ user.lastname %></h6>
									<p><%= user.email %></p>
									
								</div>
							</div>
						</div>
						<ul class="nav flex-column">
							<li class="nav-item"><a class="nav-link" href="/"><i class="bi bi-house"></i> Home</a></li>
						
							<li class="nav-item"><a class="nav-link" href="/wallet"><i class="bi bi-bag-heart"></i>Wallet</a></li>
							<li class="nav-item"><a class="nav-link" href="/vieworder"><i class="bi bi-briefcase-fill"></i> Orders</a></li>
							<li class="nav-item"><a class="nav-link" href="/manageAddresses"><i class="bi bi-geo-alt-fill"></i> Addresses</a></li>
							<li class="nav-item"><a class="nav-link" href="/"><i class="bi bi-lock-fill"></i> Change Pass</a></li>
							<li class="nav-item"><a class="nav-link" href="/logout"><i class="bi bi-box-arrow-left"></i> Logout</a></li>
						</ul>
					</div>
				</div>
			</div>

			<div class="col-md-9">
				<div class="osahan-account-page-right shadow-sm bg-white p-4 h-100">
				  <div class="tab-content" id="myTabContent">
					<div class="tab-pane fade active show" id="addresses" role="tabpanel" aria-labelledby="addresses-tab">
					  <h4 class="font-weight-bold mt-0 mb-4">Orders</h4>
					  <div class="container">
						<div class="row justify-content-center">
						  <div class="col border">
							<div class="bg-light p-4">
							  <div class="tab-content">
								<div class="tab-pane fade show active" id="nav-pending">
								  <div class="table-responsive">
									<table class="table table-borderless">
									  <thead>
										<tr>
										  <th scope="col">SL No.</th>
										  <th scope="col">Payment Status</th>
										  <th scope="col">Order Date & Time</th>
										  <th scope="col">Order Status</th>
										  <th scope="col">Order Total</th>
										  <th scope="col">Final Amount</th>
										  <th scope="col">Actions</th>
										</tr>
									  </thead>
									  <tbody>
										<% orders.forEach((order, i) => { %>
										<tr>
										  <td class="text-center align-middle"><%= i + 1 %></td>
										  <td class="text-center align-middle">
											<% if (order.paymentStatus === 'Completed') { %>
											  <span class="badge badge-success">Payment Completed</span>
											<% } else if (order.paymentStatus === 'Pending') { %>
											  <span class="badge badge-warning">Payment Pending</span>
											<% } else if (order.paymentStatus === 'failure') { %>
											  <span class="badge badge-danger">Payment Failed</span>
											  <button class="btn btn-primary text-white mb-2 retry-payment-btn" data-order-id="<%= order._id %>">Retry Payment</button>
											<% } else if (order.paymentStatus === 'Refunded') { %>
											  <span class="badge badge-info">Refunded to Wallet</span>
											<% } else { %>
											  <span class="badge badge-secondary">Unknown Status</span>
											<% } %>
											
										  </td>
										  <td class="text-center align-middle"><%= order.orderDate.toLocaleString() %></td>
										  <td class="text-center align-middle">
											<% if (order.status === 'Pending') { %>
											  <span class="alert alert-danger">Pending</span>
											<% } else if (order.status === 'Completed') { %>
											  <span class="alert alert-success">Completed</span>
											<% } else if (order.status === 'Delivered') { %>
											  <span class="alert alert-info">Delivered</span>
											<% } else if (order.status === 'Cancelled') { %>
											  <span class="alert alert-danger">Cancelled</span>
											<% } else if (order.status === 'Returned') { %>
											  <span class="alert alert-info">Returned</span>
											<% } else if (order.status === 'Shipped') { %>
											  <span class="alert alert-warning">Shipped</span>
											<% } %>
										  </td>
										  <td class="text-center align-middle"><%= order.totalAmount %></td>
										  <td id="finalPriceDom" class="text-center align-middle "><%= order.finalAmount %></td>
										  <td class="text-center align-middle">
											<div class="d-flex flex-column align-items-center">
											  <% if (order.paymentStatus === 'Failure') { %>
												<button  class="btn btn-primary text-white mb-2 retry-payment-btn" data-order-id="<%= order._id %>">Retry Payment</button>
											  <% } %>
											  <% if (order.status === 'Delivered') { %>
												<button class="btn btn-secondary text-white mb-2 return-btn" data-order-id="<%= order._id %>">Return</button>
											  <% } else if (order.status !== 'Cancelled' && order.status !== 'Returned') { %>
												<button id="orderIdbtn" class="btn btn-warning text-white mb-2 cancel-btn" data-order-id="<%= order._id %>">Cancel</button>
											  <% } else if (order.status === 'Cancelled') { %>
												<button class="btn btn-danger text-white mb-2" disabled>Cancelled</button>
											  <% } else if (order.status === 'Returned') { %>
												<button class="btn btn-info text-white mb-2" disabled>Returned</button>
											  <% } %>
											  <a href="/viewsingleorder?oid=<%= order._id %>">
												<button class="btn btn-info text-white view-order-btn">View</button>
											  </a>
											  <% if (order.paymentStatus === 'Completed') { %>
												<a href="/download-invoice/<%= order._id %>" target="_blank" title="Download Invoice" class="btn btn-primary text-white mb-1 mt-2">
													<i class="fas fa-download"></i> Invoice
												  </a>
											  <% } %>
											</div>
										  </td>
										</tr>
										<% }); %>
									  </tbody>
									</table>
								  </div>
								</div>
							  </div>
							</div>
						  </div>
						</div>
					  </div>
					</div>
				  </div>
				</div>
			  </div>
			  
			
			
		</div>
	</div>


	</div>

		


	


		<!-- Footer -->
		<footer class="bg3 p-t-75 p-b-32">
			<div class="container">
				<div class="row">
					<div class="col-sm-6 col-lg-3 p-b-50">
						<h4 class="stext-301 cl0 p-b-30">
							Categories
						</h4>

						<ul>
							<li class="p-b-10">
								<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
									Women
								</a>
							</li>

							<li class="p-b-10">
								<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
									Men
								</a>
							</li>

							<li class="p-b-10">
								<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
									Kids
							</li>

						</ul>
					</div>

					<div class="col-sm-6 col-lg-3 p-b-50">
						<h4 class="stext-301 cl0 p-b-30">
							Help
						</h4>

						<ul>
							<li class="p-b-10">
								<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
									Track Order
								</a>
							</li>

							<li class="p-b-10">
								<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
									Returns
								</a>
							</li>

							<li class="p-b-10">
								<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
									Shipping
								</a>
							</li>

						</ul>
					</div>

					<div class="col-sm-6 col-lg-3 p-b-50">
						<h4 class="stext-301 cl0 p-b-30">
							GET IN TOUCH
						</h4>

						<p class="stext-107 cl7 size-201">
							Any questions? Let us know in store at 8th floor, 379 Hudson St, New York, NY 10018 or call us
							on (+1) 96 716 6879
						</p>

						<div class="p-t-27">
							<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
								<i class="fa fa-facebook"></i>
							</a>

							<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
								<i class="fa fa-instagram"></i>
							</a>

							<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
								<i class="fa fa-pinterest-p"></i>
							</a>
						</div>
					</div>

					<div class="col-sm-6 col-lg-3 p-b-50">
					</div>
				</div>

				<div class="p-t-40">
					<div class="flex-c-m flex-w p-b-18">
						<a href="#" class="m-all-1">
							<img src="images/icons/icon-pay-01.png" alt="ICON-PAY">
						</a>

						<a href="#" class="m-all-1">
							<img src="images/icons/icon-pay-02.png" alt="ICON-PAY">
						</a>

						<a href="#" class="m-all-1">
							<img src="images/icons/icon-pay-03.png" alt="ICON-PAY">
						</a>

						<a href="#" class="m-all-1">
							<img src="images/icons/icon-pay-04.png" alt="ICON-PAY">
						</a>

						<a href="#" class="m-all-1">
							<img src="images/icons/icon-pay-05.png" alt="ICON-PAY">
						</a>
					</div>

				</div>
			</div>
		</footer>


		<!-- Back to top -->
		<div class="btn-back-to-top" id="myBtn">
			<span class="symbol-btn-back-to-top">
				<i class="zmdi zmdi-chevron-up"></i>
			</span>
		</div>



		<script>
			document.addEventListener('DOMContentLoaded', () => {
				function addEventListenersToButtons() {
					const viewOrderBtns = document.querySelectorAll('.view-order-btn');
					const cancelBtns = document.querySelectorAll('.cancel-btn');
					const returnBtns = document.querySelectorAll('.return-btn');
	
					viewOrderBtns.forEach(btn => {
						btn.addEventListener('click', function () {
							const orderId = this.getAttribute('data-order-id');
							const url = `/viewsingleorder?oid=${orderId}`;
							window.location.href = url;
						});
					});
	
					cancelBtns.forEach(btn => {
  btn.addEventListener('click', function () {
    const orderId = this.getAttribute('data-order-id');
    Swal.fire({
      title: "Are you sure?",
      text: "Cancel this order?",
      icon: "warning",
      input: 'text',
      inputPlaceholder: 'Please provide a reason',
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Ok",
    }).then((result) => {
      if (result.isConfirmed && result.value) {
        const reason = result.value;
        fetch(`/cancelOrder/${orderId}?reason=${encodeURIComponent(reason)}`, {
          method: "GET",
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            Swal.fire({
              title: "Order Cancelled",
              text: data.message,
              icon: "success",
            }).then(() => {
              window.location.reload();
            });
          } else {
            Swal.fire({
              title: "Cancellation Failed",
              text: data.message,
              icon: "error",
            });
          }
        })
        .catch(error => {
          console.error("Error:", error);
          Swal.fire({
            title: "Error",
            text: "An error occurred while cancelling the order.",
            icon: "error",
          });
        });
      }
    });
  });
});

returnBtns.forEach(btn => {
  btn.addEventListener('click', function () {
    const orderId = this.getAttribute('data-order-id');
    Swal.fire({
      title: "Are you sure?",
      text: "Return this order?",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Yes, return it!",
    }).then((result) => {
      if (result.isConfirmed) {
        fetch(`/returnOrder/${orderId}`, {
          method: "POST",
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ orderId: orderId })
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            Swal.fire({
              title: "Returned!",
              text: data.message,
              icon: "success",
              showClass: {
                popup: 'animate__animated animate__fadeInDown'
              },
              hideClass: {
                popup: 'animate__animated animate__fadeOutUp'
              }
            }).then(() => {
              window.location.reload();
            });
          } else {
            Swal.fire({
              title: "Failed!",
              text: data.message,
              icon: "error",
              showClass: {
                popup: 'animate__animated animate__shakeX'
              },
              hideClass: {
                popup: 'animate__animated animate__fadeOutUp'
              }
            });
          }
        })
        .catch(error => {
          console.error("Error:", error);
          Swal.fire({
            title: "Error!",
            text: "Something went wrong.",
            icon: "error",
            showClass: {
              popup: 'animate__animated animate__shakeX'
            },
            hideClass: {
              popup: 'animate__animated animate__fadeOutUp'
            }
          });
        });
      }
    });
  });
});
}
				// Initial call to add event listeners to buttons
				addEventListenersToButtons();
			});
		</script>
	
	<script>
	
	document.addEventListener('DOMContentLoaded', () => {
	  function addEventListenersToButtons() {
		const retryPaymentBtns = document.querySelectorAll('.retry-payment-btn');
		retryPaymentBtns.forEach(btn => {
		  btn.addEventListener('click', () => {
			const orderId = btn.getAttribute('data-order-id');
			retryPayment(orderId);
		  });
		});
	
		// Add event listeners for other buttons here...
	  }
	
	  addEventListenersToButtons();
	});
	</script>
	
	<script>
	
		// document.getElementById("failureButton").addEventListener("click",retryPayment)
	
	async function retryPayment(orderId) {
		console.log("vsfd");
		const totalWithDeliveryCharge= document.getElementById("finalPriceDom").innerHTML
		console.log("totalWithDeliveryCharge",totalWithDeliveryCharge);
	  try {
		console.log("vsfd");
	
		const response = await fetch(`/getOrderDetails`, {
		  method: 'POST',
		  headers: {
			'Content-Type': 'application/json',
		  },
		  body: JSON.stringify({ totalPrice: totalWithDeliveryCharge })
		});
	
		const orderDetails = await response.json();
	
	
	
	
		if (orderDetails.orderId) {
	
		  const options = {
			key: 'rzp_test_OYzzRLNBCqZfkG', // Replace with your Razorpay key
			amount:5432 * 100, // Convert to paise
			currency: 'INR',
			name: 'Shoes Kampany',
			description: 'Retry Payment',
			order_id:orderDetails.orderId, // You'll need to create a new Razorpay order for the retry
			handler: async function(response){
				handlePayment(response,orderDetails.orderId)
			},
			prefill: {
			  name: 'Akshay', // Replace with appropriate user details
			  email: 'akshayjyothip@gmail.com',
			  contact: '8281935725',
			},
			notes: {
			  address: 'Razorpay Corporate Office',
			},
			theme: {
			  color: '#F37254',
			},
		  };
	
		  const rzp1 = new Razorpay(options);
		  rzp1.open();
		} 
	  } catch (error) {
		console.error('Error retrying payment:', error);
		alert('An error occurred while retrying payment. Please try again later.');
	  }
	}
	</script>
	<script>
	
	async function handlePayment (response,orderid) {
		try {
			console.log("herer");
		  const orderId = document.getElementById("orderIdbtn").getAttribute('data-order-id');
		  console.log(orderId,"orderid");
		  const paymentResponse = await fetch('/changeToSucess', {
			method: 'PUT',
			headers: {
			  'Content-Type': 'application/json',
			},
			body: JSON.stringify({
			  orderId: orderId,
			  razorpay_payment_id: response.razorpay_payment_id,
			  razorpay_order_id: response.razorpay_order_id,
			  razorpay_signature: response.razorpay_signature,
			}),
		  });
	
		  console.log(paymentResponse,"paymentResponse");
	
		  if (paymentResponse.ok) {
			// Payment successful, handle UI updates or redirects
			// alert('Payment retried successfully!');
			window.location.href = '/successPage';
		  } else {
			// Handle retry payment failure scenarios
			alert('Failed to retry payment. Please try again.');
		  }
		} catch (error) {
		  console.error('Error handling retry payment:', error);
		  alert('An error occurred while handling retry payment. Please try again later.');
		}
	  }
	</script>
			


		<!--===============================================================================================-->
		<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
		<!--===============================================================================================-->
		<script src="vendor/animsition/js/animsition.min.js"></script>
		<!--===============================================================================================-->
		<script src="vendor/bootstrap/js/popper.js"></script>
		<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
		<!--===============================================================================================-->
		<script src="vendor/select2/select2.min.js"></script>
		<script>
			$(".js-select2").each(function () {
				$(this).select2({
					minimumResultsForSearch: 20,
					dropdownParent: $(this).next('.dropDownSelect2')
				});
			})
		</script>





		<!-- Add SweetAlert JavaScript code -->
		<!-- Add SweetAlert JavaScript code -->
		<script>
			// Wait for the DOM to be fully loaded
			$(document).ready(function () {
				// Attach click event listener to delete buttons
				$('.delete').on('click', function (e) {
					e.preventDefault(); // Prevent default link behavior

					// Get the data-id attribute of the delete button
					const productId = $(this).data('id');

					// Show confirmation dialog
					swal.fire({
						title: "Are you sure?",
						text: "Do you really want to delete this record?",
						icon: "warning",
						showCancelButton: true,
						confirmButtonText: "Yes, delete it!",
						cancelButtonText: "No, cancel",
						reverseButtons: true
					}).then((result) => {
						// Check if user confirmed deletion
						if (result.isConfirmed) {
							// Send AJAX request to delete the item
							$.ajax({
								url: `/delete/${productId}`, // Replace with the correct endpoint
								method: 'DELETE',
								success: function (response) {
									// If deletion is successful, remove the corresponding table row
									$(e.target).closest('tr').remove();

									// Show success message
									swal.fire({
										title: "Deleted!",
										text: "Item has been deleted successfully",
										icon: "success",
										confirmButtonText: "OK"
									});
								},
								error: function (xhr, status, error) {
									console.error(error); // Log any errors to the console

									// Show error message
									swal.fire({
										title: 'Error!',
										text: 'Failed to delete item',
										icon: 'error',
										confirmButtonText: 'OK'
									});
								}
							});
						}
					});
				});
			});
		</script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script> 




		<!--===============================================================================================-->
		<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
		<!--===============================================================================================-->
		<script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
		<script>
			$('.js-pscroll').each(function () {
				$(this).css('position', 'relative');
				$(this).css('overflow', 'hidden');
				var ps = new PerfectScrollbar(this, {
					wheelSpeed: 1,
					scrollingThreshold: 1000,
					wheelPropagation: false,
				});

				$(window).on('resize', function () {
					ps.update();
				})
			});
		</script>
		<!-- SweetAlert JavaScript -->
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<!--===============================================================================================-->
		<script src="js/main.js"></script>


	</body>

	</html>
