<!DOCTYPE html>
<html lang="en">

<head>
  <title>Shoping Cart</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/png" href="images/icons/favicon.png" />
  <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
  <link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.min.css">
  <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
  <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
  <link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
  <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
  <link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
  <link rel="stylesheet" type="text/css" href="css/util.css">
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5+5hb7O5ChI5Y9Y5mIRGnIjD7HihSNF+h3jcqMIe" crossorigin="anonymous"></script>
  <style>

.coupon-dropdown {
  position: relative;
}

.dropdown-menu {
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}

.dropdown-item {
  padding: 10px;
  border-bottom: 1px solid #ec8282;
}

.dropdown-item:hover {
  background-color: #ac5050;
}

.copy-btn {
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 5px;
  cursor: pointer;
}

.no-coupons {
  font-size: 16px;
  color: #666;
  margin-top: 10px;
}

    /* Customize SweetAlert2 popup style */
.swal2-popup.styled-popup {
  width: 350px !important;
  padding: 20px !important;
  border-radius: 10px !important;
  background: linear-gradient(135deg, #ffdde1 0%, #ee9ca7 100%);
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
}

.swal2-title {
  font-size: 24px !important;
  font-family: 'Arial', sans-serif;
  color: #dc3545;
}

.swal2-html-container {
  font-size: 16px !important;
  font-family: 'Arial', sans-serif;
  color: #721c24;
}

/* Customize SweetAlert2 icon */
.swal2-icon.styled-icon {
  border-color: #dc3545 !important;
}

.swal2-icon.styled-icon::before, 
.swal2-icon.styled-icon::after {
  background-color: #dc3545 !important;
}

/* Add animation */
.swal2-popup {
  animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
  0% { opacity: 0; transform: scale(0.9); }
  100% { opacity: 1; transform: scale(1); }
}

    .payment-method h3 {
      font-size: 1.5rem;
    }

    .payment-method .form-check {
      margin-top: 10px;
      margin-bottom: 10px;
    }

    .payment-method .form-check-input {
      margin-top: 0.3rem;
    }

    .payment-method .form-check-label {
      margin-left: 0px;
      font-size: .8rem;
    }

    .custom-alert {
      font-size: 0.8rem;
      /* Smaller font size */
      font-family: 'Arial', sans-serif;
      /* Stylish font */
      padding: 10px;
      /* Smaller padding */
      border-radius: 5px;
      /* Slightly round the corners */
      margin-bottom: 0.5rem;
      /* Smaller margin at the bottom */
      background-color: #ffefc1;
      /* Custom background color */
      color: #856404;
      /* Custom text color */
      border: 1px solid #ffeeba;
      /* Custom border color */
    }
  </style>

  <style>
    body {
      background-color: #f8f9fa;
    }

    .order-details,
    .address-selection,
    .payment-method,
    .total-amount {
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .btn-place-order {
      display: block;
      margin: 20px auto;
      width: 100%;
    }

    .object-fit-cover {
      object-fit: cover;
      height: 75px;
      width: 75px;
    }

    .banner-wrapper {
      background-color: black;
      padding: 10px;
    }

    .banner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .banner h1 {
      font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
      padding-left: 10px;
      margin-top: 0;
      color: white;
    }

    .form-outline-inline {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .form-outline-inline input[type="search"] {
      width: 100%;
      margin-right: 5px;
    }

    .icons {
      align-items: center;
    }

    .icons a {
      margin-right: 10px;
    }

    @media (min-width: 768px) {
      .banner h1 {
        margin-bottom: 0;
      }

      .form-outline-inline input[type="search"] {
        width: auto;
        margin-right: 0;
      }

      .row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -15px;
        margin-left: -15px;
      }

      .col-half {
        flex: 0 0 50%;
        max-width: 50%;
        padding-right: 15px;
        padding-left: 15px;
      }
    }

    @media (max-width: 767px) {
      .col-half {
        flex: 0 0 100%;
        max-width: 100%;
        padding-right: 15px;
        padding-left: 15px;
      }
    }

    .btn-place-order {
      display: flex;
      justify-content: center;
      margin: 20px auto;
      width: 50%;
    }

    @media (max-width: 767px) {
      .btn-place-order {
        width: 100%;
      }
    }

    .address-selection-container {
      background-color: #faf8f8;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }

    .address-title {
      margin-bottom: 10px;
      font-size: 18px;
      font-weight: bold;
    }

    .address-details {
      border-top: 1px solid #ccc;
      margin-top: 10px;
      padding-top: 10px;
    }

    .address-label {
      font-size: 16px;
      margin-bottom: 5px;
      color: #333;
    }

    .address-value {
      font-size: 14px;
      color: #555;
    }

    .add-address-btn {
      margin-top: 10px;
      background-color: #ffc107;
      color: #17007d;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    .add-address-btn:hover {
      background-color: #bc0b0b;
    }

    .container-box-1 {
      border: 2px solid black;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }

    @keyframes alert {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

    .stock-low {
      color: red;
      animation: alert 2s infinite;
    }

    .form-group {
      margin-bottom: 1em;
    }

    .validation-message {
      color: red;
    }

    .modal-window {
      position: fixed;
      background-color: rgba(255, 255, 255, 0.25);
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      z-index: 999;
      visibility: hidden;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
    }

    .modal-window:target {
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }

    .modal-window>div {
      width: 400px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 1em;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 2px solid black;
    }

    .modal-close {
      color: #aaa;
      line-height: 50px;
      font-size: 80%;
      position: absolute;
      right: 0;
      text-align: center;
      top: 0;
      width: 70px;
      text-decoration: none;
    }

    .modal-close:hover {
      color: black;
    }

    html,
    body {
      height: 100%;
    }

    html {
      font-size: 18px;
      line-height: 1.4;
    }

    body {
      font-family: apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
      font-weight: 600;
      color: black;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .btn {
      display: inline-block;
      background-color: #007BFF;
      color: white;
      padding: 1em 1.5em;
      border-radius: 0.5rem;
      text-decoration: none;
      transition: background-color 0.3s, transform 0.3s;
      font-size: 1rem;
      font-weight: bold;
    }

    .btn:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }

    button {
      background: none;
      border: none;
      color: inherit;
      font: inherit;
      cursor: pointer;
    }

    form {
      display: flex;
      flex-direction: column;
    }

    label {
      margin-top: 5px;
      font-weight: bold;
      font-size: 0.9rem;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"] {
      padding: 8px;
      margin-top: 3px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }

    input[type="submit"] {
      margin-top: 10px;
      padding: 8px 12px;
      border: none;
      background-color: #007BFF;
      color: white;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.3s;
    }

    input[type="submit"]:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }

    .container-box-2 {
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #f9f9f9;
    }

    .coupon-success {
      color: green;
      margin-top: 10px;
    }
.error-message{
  color: #bc0b0b;
}
    .dropdown-menu a {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
  </style>

  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .small-modal {
      max-width: 400px;
      /* Adjust width as needed */
      max-height: 90vh;
      /* Adjust height as needed */
    }

    .small-modal .modal-content {
      max-height: calc(90vh - 50px);
      /* Account for modal header and footer */
      overflow-y: auto;
    }
  </style>

</head>

<body class="animsition" style="margin: 0px;">

  <!-- Header -->
  <header class="header-v4">
    <!-- Header desktop -->
    <div class="container-menu-desktop">
      <!-- Topbar -->
      <div class="top-bar">
        <div class="content-topbar flex-sb-m h-full container">
          <div class="left-top-bar">
            Free shipping for standard order over $100
          </div>

          <div class="right-top-bar flex-w h-full">

            <a href="#" class="flex-c-m trans-04 p-lr-25">
              My Account
            </a>
          </div>
        </div>
      </div>

      <div class="wrap-menu-desktop how-shadow1">
        <nav class="limiter-menu-desktop container">

          <!-- Logo desktop -->
          <a href="#" class="logo">
            <img src="images/icons/logo-01.png" alt="IMG-LOGO">
          </a>

          <!-- Menu desktop -->
          <div class="menu-desktop">
            <ul class="main-menu">
              <li>
                <a href="/">Home</a>
              </li>

              <li>
                <a href="/shop">Shop</a>
              </li>

            </ul>
          </div>

          <!-- Icon header -->
          <div class="wrap-icon-header flex-w flex-r-m">
            <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
              <i class="zmdi zmdi-search"></i>
            </div>

            <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti js-show-cart"
              data-notify="<%= cart.items.length %>">
              <i class="zmdi zmdi-shopping-cart"></i>
            </div>

            <a href="#" class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti" data-notify="0">
              <i class="zmdi zmdi-favorite-outline"></i>
            </a>
          </div>

        </nav>
      </div>
    </div>

    <!-- Header Mobile -->
    <div class="wrap-header-mobile">
      <!-- Logo moblie -->
      <div class="logo-mobile">
        <a href="index.html"><img src="images/icons/logo-01.png" alt="IMG-LOGO"></a>
      </div>

      <!-- Icon header -->
      <div class="wrap-icon-header flex-w flex-r-m m-r-15">
        <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 js-show-modal-search">
          <i class="zmdi zmdi-search"></i>
        </div>

        <div class="icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti js-show-cart" data-notify="2">
          <i class="zmdi zmdi-shopping-cart"></i>
        </div>

        <a href="#" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-r-11 p-l-10 icon-header-noti"
          data-notify="0">
          <i class="zmdi zmdi-favorite-outline"></i>
        </a>
      </div>


      <!-- Button show menu -->
      <div class="btn-show-menu-mobile hamburger hamburger--squeeze">
        <span class="hamburger-box">
          <span class="hamburger-inner"></span>
        </span>
      </div>
    </div>


    <!-- Menu Mobile -->
    <div class="menu-mobile">
      <ul class="topbar-mobile">
        <li>
          <div class="left-top-bar">
            Free shipping for standard order over $100
          </div>
        </li>

        <li>
          <div class="right-top-bar flex-w h-full">

            <a href="#" class="flex-c-m p-lr-10 trans-04">
              My Account


          </div>
        </li>
      </ul>

      <ul class="main-menu-m">
        <li>
          <a href="index.html">Home</a>

          <span class="arrow-main-menu-m">
            <i class="fa fa-angle-right" aria-hidden="true"></i>
          </span>
        </li>

        <li>
          <a href="product.html">Shop</a>
        </li>

      </ul>
    </div>

    <!-- Modal Search -->
    <div class="modal-search-header flex-c-m trans-04 js-hide-modal-search">
      <div class="container-search-header">
        <button class="flex-c-m btn-hide-modal-search trans-04 js-hide-modal-search">
          <img src="images/icons/icon-close2.png" alt="CLOSE">
        </button>

        <form class="wrap-search-header flex-w p-l-15">
          <button class="flex-c-m trans-04">
            <i class="zmdi zmdi-search"></i>
          </button>
          <input class="plh3" type="text" name="search" placeholder="Search...">
        </form>
      </div>
    </div>
  </header>

  <!-- Cart -->
  <div class="wrap-header-cart js-panel-cart">
    <div class="s-full js-hide-cart"></div>

    <div class="header-cart flex-col-l p-l-65 p-r-25">
      <div class="header-cart-title flex-w flex-sb-m p-b-8">
        <span class="mtext-103 cl2">
          Your Cart
        </span>

        <div class="fs-35 lh-10 cl2 p-lr-5 pointer hov-cl1 trans-04 js-hide-cart">
          <i class="zmdi zmdi-close"></i>
        </div>
      </div>

      <div class="header-cart-content flex-w js-pscroll">
        <ul class="header-cart-wrapitem w-full">
          <% if (cart && cart.items && cart.items.length> 0) { %>
            <% cart.items.forEach((item)=> { %>
              <li class="header-cart-item flex-w flex-t m-b-12">
                <div class="header-cart-item-img">
                  <img src="<%= item.productId.images[0] %>" alt="IMG">
                </div>
                <div class="header-cart-item-txt p-t-8">
                  <a href="#" class="header-cart-item-name m-b-18 hov-cl1 trans-04">
                    <%= item.productId.product_name %>
                  </a>
                  <span class="header-cart-item-info">&#x20a8; <%= item.productId.price %></span>
                </div>
              </li>
              <% }); %>
                <% } else { %>
                  <li class="header-cart-item flex-w flex-t m-b-12">
                    Cart is empty.....
                  </li>
                  <% } %>


        </ul>

        <!-- <div class="w-full">
					<div class="header-cart-total w-full p-tb-40">
						Total: $75.00
					</div> -->

        <div class="header-cart-buttons flex-w w-full">
          <a href="/shoping-cart"
            class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-r-8 m-b-10">
            View Cart
          </a>

          <a href="shoping-cart.html" class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-b-10">
            Check Out
          </a>
        </div>
      </div>
    </div>
  </div>
  </div>



  <!-- breadcrumb -->
  <div class="container">
    <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
      <a href="index.html" class="stext-109 cl8 hov-cl1 trans-04">
        Home
        <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
      </a>
      <span class="stext-109 cl4">
        Shopping Cart
      </span>
    </div>
  </div>
  <div class="container mt-4">
    <h1 class="text-center pt-5">Checkout</h1>

    <% if (cart.items.length === 0) { %>
        <div class="alert alert-danger mt-3 text-center" role="alert" style="font-weight: bold; font-size: 1.2rem;">
            Your cart is empty. Please add items to your cart before checking out.
        </div>
    <% } else { %>

        <% if (errorMessage) { %>
        <div class="alert alert-danger mt-3" role="alert">
            <%= errorMessage %>
        </div>
        <% } %>

        <form id="orderForm" action="/placeOrder" method="POST">
            <div class="row mt-3" style="padding: 48px;">
                <!-- Left Side Section -->
                <div class="col-md-6">
                    <!-- Order Details Section -->
                    <div class="order-details container-box-1">
                        <h3>Your Order</h3>
                        <hr />
                        <div class="cart-items">
                            <% cart.items.forEach(item => { %>
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-md-2">
                                                <img src="<%= item.productId.images[0] %>" alt="Product Image" class="img-fluid object-fit-cover" />
                                            </div>
                                            <div class="col-md-8">
                                                <h5 class="card-title">
                                                    <%= item.productId.product_name %>
                                                </h5>
                                                <% if (item.productId.offerPrice) { %>
                                                    <p>
                                                        Qty: <%= item.quantity %> || 
                                                        <span class="original-price" style="text-decoration: line-through; color: red;">Price: &#x20a8; <%= item.productId.price * item.quantity %></span> || 
                                                        <span class="offer-price" style="color: green;">Offer Price: &#x20a8; <%= item.productId.offerPrice * item.quantity %></span>
                                                    </p>
                                                    <p>
                                                        <span class="discount-amount" style="color: green;">You saved: &#x20a8; <%= (item.productId.price * item.quantity) - (item.productId.offerPrice * item.quantity) %></span>
                                                    </p>
                                                <% } else { %>
                                                    <p>Qty: <%= item.quantity %> || Total Price: &#x20a8; <%= item.productId.price * item.quantity %></p>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        </div>
                    </div>
                    <input type="hidden" id="cartId" name="cartId" value="<%= cart._id %>">

                    <!-- Address Selection Section -->
                    <div class="address-selection mt-2 container-box-1">
                        <h3>Choose Address</h3>
                        <hr />
                        <select class="form-control" id="addressSelect" name="selectedAddress">
                            <% addresses.forEach((address, i) => { %>
                                <option value="<%= address._id %>" <%= i === 0 ? 'selected' : '' %>>
                                    <%= address.name %> - Address <%= i + 1 %>: <%= address.address %>, <%= address.state %>, <%= address.pincode %>
                                </option>
                            <% }) %>
                        </select>
                        <button type="button" class="btn btn-warning mt-3" id="addAddressButton" data-toggle="modal" data-target="#addressModal">Add Address</button>
                    </div>

                    <!-- Payment Method -->
                    <div class="payment-method mt-2 container-box-2">
                        <h3 class="text-center" style="font-size: 1.5rem;">Payment Method</h3>
                        <hr />
                        <div class="form-check d-flex align-items-center">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="COD" id="codRadio" <% if (cart.totalAmount >= 1000) { %> disabled <% } %> />
                            <label class="form-check-label ms-2" for="codRadio">Cash On Delivery</label>
                        </div>
                        <% if (cart.totalAmount >= 1000) { %>
                            <div class="custom-alert mt-2" role="alert">
                                Cash on Delivery is not available for orders above &#x20a8; 1000.
                            </div>
                        <% } %>
                        <div class="form-check d-flex align-items-center" style="margin-left: 0px;">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="RazorPay" id="razorPayRadio" />
                            <label class="form-check-label ms-2" for="razorPayRadio">RazorPay Payment</label>
                        </div>
                        <div class="form-check d-flex align-items-center">
                            <input class="form-check-input" type="radio" name="paymentMethod" value="Wallet" id="walletRadio" <% if (walletBalance < cart.finalAmount) { %> disabled <% } %> />
                            <label class="form-check-label ms-2" for="walletRadio">Wallet Payment (Balance: &#x20a8; <span id="walletBalance"><%= walletBalance %></span>)</label>
                        </div>
                        <% if (walletBalance < cart.finalAmount) { %>
                            <div class="custom-alert mt-2" role="alert">
                                Wallet balance is insufficient for this order. Please try another payment method.
                            </div>
                        <% } %>
                    </div>
                </div>

                <!-- Right Side Section -->
                <div class="col-md-6">
                    <div class="container mt-4">
                        <div class="container-box-2">
                            <h3>Coupon</h3>
                            <hr />
                            <div id="couponSection">
                              <% if (cart.appliedCoupon) { %>
                                <input type="text" class="form-control" id="couponCodeInput" placeholder="Coupon Applied" value="<%= cart.appliedCoupon %>" disabled>
                                <button type="button" class="btn btn-primary mt-2" id="applyCouponBtn" disabled>Apply Coupon</button>
                                <button type="button" class="btn btn-danger mt-2" onclick="removeCoupon()">Remove Coupon</button>
                                <p class="coupon-success" id="couponSuccessMessage">Coupon applied successfully!</p>
                              <% } else { %>
                                <input type="text" class="form-control" id="couponCodeInput" placeholder="Enter coupon code manually">
                                <button type="button" class="btn btn-primary mt-2" id="applyCouponBtn" onclick="applyCoupon()">Apply Coupon</button>
                                <p class="coupon-success" id="couponSuccessMessage" style="display: none;">Coupon applied successfully!</p>
                                <p class=" error-message" id="couponErrorMessage" style="display: none;">">No coupon code entered. Please enter a coupon code..</p>
                              <% } %>
                          </div>
                          
                          
                            <!-- Available Coupons -->
                       <!-- Available Coupons -->
<!-- Available Coupons -->
<div class="coupon-dropdown mt-2">
  <% if (coupon && coupon.length > 0) { %>
    <button class="btn btn-secondary dropdown-toggle" type="button" id="availableCouponDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Available Coupons <span class="caret"></span>
    </button>
    <div class="dropdown-menu" aria-labelledby="availableCouponDropdown">
      <% coupon.forEach((coupon) => { %>
        <a class="dropdown-item" href="#" onclick="copyCouponCode(event, '<%= coupon.coupon_Code %>')">
          <%= coupon.coupon_Name %> - <%= coupon.coupon_Code %>
          <button type="button" class="btn btn-secondary btn-sm ml-2 copy-btn">Copy</button>
          <input type="text" id="couponInput_<%= coupon.coupon_Code %>" style="display: none;">
          <span id="copyMessage_<%= coupon.coupon_Code %>"></span>
        </a>
      <% }) %>
    </div>
  <% } else { %>
    <p class="no-coupons">No Coupons available</p>
  <% } %>
</div>
                        </div>
                    </div>

                    <!-- Total Amount Section -->
                    <div class="total-amount mt-3 container-box-2 text-center">
                        <h3 style="font-size: 1.5rem;">Total Amount</h3>
                        <hr />
                        <p id="appliedCoupon" style="color: green; font-size: 0.9rem;"><i class="fa fa-tag"></i> Applied Coupon: <%= cart.appliedCoupon || 'None' %></p>
                        <p id="discountAmount" style="color: green; font-size: 0.9rem;"><i class="fa fa-percent"></i> Coupon Discount: &#x20a8; <%= cart.couponDiscount || 0 %></p>

                        <% if (!isNaN(cart.offerDiscount) && cart.offerDiscount > 0) { %>
                            <p id="offerDiscount" style="color: green; font-size: 0.9rem;"><i class="fa fa-gift"></i> Offer Discount: &#x20a8; <%= cart.offerDiscount %></p>
                        <% } %>

                        <p id="deliveryCharge" style="color: green; font-size: 0.9rem;"><i class="fa fa-truck"></i> Delivery Charge: &#x20a8; <%= cart.totalAmount >= 500 ? 50 : 0 %></p>
                        <% var totalWithDeliveryCharge = cart.totalAmount + (cart.totalAmount >= 500 ? 50 : 0); %>
                        <p id="totalAmount" style="color: black; font-weight: bold; font-size: 1.2rem;"><i class="fa fa-money"></i> Total Amount: &#x20a8; <%= totalWithDeliveryCharge %></p>

                        <div id="removeCouponButton" <% if (!isNaN(cart.couponDiscount) && cart.couponDiscount > 0) { %> style="display: block;" <% } else { %> style="display: none;" <% } %>>
                            <button type="button" class="btn btn-danger btn-sm" onclick="removeCoupon()"><i class="fa fa-times"></i> Remove Coupon</button>
                        </div>

                        <button type="submit" class="btn btn-primary btn-place-order mt-3 container-box-2" id="placeOrderBtn" style="width: 60%;"><i class="fa fa-shopping-cart"></i> Place Order</button>
                    </div>
                </div>
            </div>
        </form>
    <% } %>
</div>

<!-- Modal for Adding Address -->
<div class="modal fade" id="addressModal" tabindex="-1" aria-labelledby="addressModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered small-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addressModalLabel">Add Address</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addressForm" action="/addaddresss" method="post">
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" name="name">
                        <span id="nameValidation" class="validation-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="mobile">Mobile Number</label>
                        <input type="text" class="form-control" id="mobile" name="mobile">
                        <span id="mobileValidation" class="validation-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" class="form-control" id="address" name="address">
                        <span id="addressValidation" class="validation-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="district">District</label>
                        <input type="text" class="form-control" id="district" name="district">
                        <span id="districtValidation" class="validation-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <input type="text" class="form-control" id="state" name="state">
                        <span id="stateValidation" class="validation-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="pincode">PinCode</label>
                        <input type="text" class="form-control" id="pincode" name="pincode">
                        <span id="pincodeValidation" class="validation-message"></span>
                    </div>
                    <div class="form-group">
                        <label for="landmark">Landmark (optional)</label>
                        <input type="text" class="form-control" id="landmark" name="landmark">
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>




















  <!-- Footer -->
  <footer class="bg3 p-t-75 p-b-32">
    <div class="container">
      <div class="row">
        <div class="col-sm-6 col-lg-3 p-b-50">
          <h4 class="stext-301 cl0 p-b-30">
            Categories
          </h4>

          <ul>
            <li class="p-b-10">
              <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
                Women
              </a>
            </li>

            <li class="p-b-10">
              <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
                Men
              </a>
            </li>

            <li class="p-b-10">
              <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
                Kids
            </li>

          </ul>
        </div>

        <div class="col-sm-6 col-lg-3 p-b-50">
          <h4 class="stext-301 cl0 p-b-30">
            Help
          </h4>

          <ul>
            <li class="p-b-10">
              <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
                Track Order
              </a>
            </li>

            <li class="p-b-10">
              <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
                Returns
              </a>
            </li>

            <li class="p-b-10">
              <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
                Shipping
              </a>
            </li>

          </ul>
        </div>

        <div class="col-sm-6 col-lg-3 p-b-50">
          <h4 class="stext-301 cl0 p-b-30">
            GET IN TOUCH
          </h4>

          <p class="stext-107 cl7 size-201">
            Any questions? Let us know in store at 8th floor, 379 Hudson St, New York, NY 10018 or call us
            on (+1) 96 716 6879
          </p>

          <div class="p-t-27">
            <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
              <i class="fa fa-facebook"></i>
            </a>

            <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
              <i class="fa fa-instagram"></i>
            </a>

            <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
              <i class="fa fa-pinterest-p"></i>
            </a>
          </div>
        </div>

        <div class="col-sm-6 col-lg-3 p-b-50">
        </div>
      </div>

      <div class="p-t-40">
        <div class="flex-c-m flex-w p-b-18">
          <a href="#" class="m-all-1">
            <img src="images/icons/icon-pay-01.png" alt="ICON-PAY">
          </a>

          <a href="#" class="m-all-1">
            <img src="images/icons/icon-pay-02.png" alt="ICON-PAY">
          </a>

          <a href="#" class="m-all-1">
            <img src="images/icons/icon-pay-03.png" alt="ICON-PAY">
          </a>

          <a href="#" class="m-all-1">
            <img src="images/icons/icon-pay-04.png" alt="ICON-PAY">
          </a>

          <a href="#" class="m-all-1">
            <img src="images/icons/icon-pay-05.png" alt="ICON-PAY">
          </a>
        </div>

      </div>
    </div>
  </footer>


  <!-- Back to top -->
  <div class="btn-back-to-top" id="myBtn">
    <span class="symbol-btn-back-to-top">
      <i class="zmdi zmdi-chevron-up"></i>
    </span>
  </div>


  <script>
function copyCouponCode(event, couponCode) {
  event.stopPropagation();
  event.preventDefault();
  // Create a temporary input element
  var tempInput = document.createElement("input");
  tempInput.value = couponCode;
  document.body.appendChild(tempInput);
  // Select the text within the input element
  tempInput.select();
  // Copy the selected text
  document.execCommand("copy");
  // Remove the temporary input element
  document.body.removeChild(tempInput);
  // Show a message or perform any additional actions
  console.log("Coupon code copied: " + couponCode);
  // Add a success message
  var messageId = "copyMessage_" + couponCode;
  document.getElementById(messageId).innerHTML = "Copied!";
  setTimeout(function() {
    document.getElementById(messageId).innerHTML = "";
  }, 2000);
}
     </script>
<script>
  let totalAmount = <%= cart.totalAmount %>;
  let discountAmount = 0; // Initialize discount amount
  let couponCodeInput = document.getElementById('couponCodeInput');
  let deliveryCharge = <%= cart.totalAmount >= 500 ? 50 : 0 %>;
  let totalWithDeliveryCharge = totalAmount + deliveryCharge;

  document.getElementById('orderForm').addEventListener('submit', async function (event) {
    event.preventDefault(); // Prevent default form submission
    let continuePayment = true;

    const selectedAddress = document.getElementById('addressSelect').value;
    if (!selectedAddress) {
      Swal.fire({
        icon: 'error',
        title: '<strong>Error</strong>',
        html: '<p style="color: #721c24; font-weight: bold;">Please select an address.</p>',
        background: '#fff3f3',
        iconColor: '#dc3545',
        confirmButtonColor: '#dc3545',
        customClass: {
          popup: 'styled-popup',
          icon: 'styled-icon'
        }
      });
      continuePayment = false;
    }

    // Check if payment method is selected
    const paymentMethodSelected = document.querySelector('input[name="paymentMethod"]:checked');
    if (!paymentMethodSelected) {
      Swal.fire({
        icon: 'error',
        title: '<strong>Error</strong>',
        html: '<p style="color: #721c24; font-weight: bold;">Please select a payment method.</p>',
        background: '#fff3f3',
        iconColor: '#dc3545',
        confirmButtonColor: '#dc3545',
        customClass: {
          popup: 'styled-popup',
          icon: 'styled-icon'
        }
      });
      continuePayment = false;
    }

    // Retrieve selected payment method
    var selectedPaymentMethod = paymentMethodSelected.value;
    console.log("selectedPaymentMethod", selectedPaymentMethod);

    // Ensure the elements exist before accessing their properties
    let offerDiscountElement = document.getElementById("offerDiscount");
    let discountAmountElement = document.getElementById("discountAmount");
    let deliveryChargeElement = document.getElementById("deliveryCharge");

    // Use nullish coalescing to set a default value if the element is null
    let offerDiscount = offerDiscountElement ? offerDiscountElement.innerText.replace(/[^0-9.]/g, '') : '0';
    let discountAmount = discountAmountElement ? discountAmountElement.innerText.replace(/[^0-9.]/g, '') : '0';
    let deliveryCharge = deliveryChargeElement ? deliveryChargeElement.innerText.replace(/[^0-9.]/g, '') : '0';

    console.log('Offer Discount:', offerDiscount);
    console.log('Discount Amount:', discountAmount);
    console.log('Delivery Charge:', deliveryCharge);

    if (continuePayment && selectedPaymentMethod === 'RazorPay') {
      console.log("here");
      try {
        let response = await fetch('/createOrder', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ totalPrice: totalWithDeliveryCharge }) // Send the total amount including delivery charge
        });

        let data = await response.json();

        if (data.orderId) {
          var options = {
            "key": "rzp_test_OYzzRLNBCqZfkG",
            "amount": totalWithDeliveryCharge * 100, // Convert to paise and include delivery charge
            "currency": "INR",
            "name": "Shoes Kampany",
            "description": "Test Transaction",
            "order_id": data.orderId,
            "handler": function (response) {
              handlePayment(response); // Call function to handle payment
            },

            "prefill": {
              "name": "Akshay",
              "email": "akshayjyothip@gmail.com",
              "contact": "8281935725"
            },
            "notes": {
              "address": "Razorpay Corporate Office"
            },
            "theme": {
              "color": "#F37254"
            }
          };

          var rzp1 = new Razorpay(options);
          rzp1.open();

          rzp1.on('payment.failed', function (response) {
            alert("Payment failed. Please try again.");

            let amountTotal = document.getElementById("totalAmount").innerText;
            var selectedAddressId = document.getElementById('addressSelect').value;
            var paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            var cartId = document.getElementById('cartId').value;

            fetch('/handleFailedPayment', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                cartId,
                selectedAddressId,
                paymentMethod,
                amountTotal,
                razorpay_payment_id: response.error.metadata.payment_id,
                razorpay_order_id: response.error.metadata.order_id,
                error_description: response.error.description
              })
            })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                window.location.href = '/vieworder';
              } else {
                alert('Failed to handle payment failure. Please try again.');
                window.location.href = '/vieworder';
              }
            })
            .catch(error => {
              console.error('Error handling payment failure:', error);
              alert('An error occurred while handling payment failure. Please try again.');
              window.location.href = '/vieworder';
            });
          });
        }
      } catch (error) {
        console.error("Error initiating Razorpay payment:", error);
        alert('An error occurred while initiating payment. Please try again.');
      }
    } else if (continuePayment && selectedPaymentMethod === 'Wallet') {
      try {
        let amountTotal = document.getElementById("totalAmount").innerText;
        var selectedAddressId = document.getElementById('addressSelect').value;
        var cartId = document.getElementById('cartId').value;

        let paymentDetails = {
          addressId: selectedAddressId,
          paymentMethod: selectedPaymentMethod,
          cartId: cartId,
          amountTotal: amountTotal,
          offerDiscount: offerDiscount,
          discountAmount: discountAmount,
          deliveryCharge: deliveryCharge
        };

        let response = await fetch('/placeOrder', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(paymentDetails)
        });

        let result = await response.text();
        window.location.href = '/successPage';
      } catch (error) {
        console.error("Error handling wallet payment:", error);
      }
    } else if (continuePayment && selectedPaymentMethod === 'COD') {
      let amountTotal = document.getElementById("totalAmount").innerText;
      var selectedAddressId = document.getElementById('addressSelect').value;
      var selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
      var cartId = document.getElementById('cartId').value;

      try {
        let paymentDetails = {
          addressId: selectedAddressId,
          paymentMethod: selectedPaymentMethod,
          cartId: cartId,
          amountTotal: amountTotal,
          offerDiscount: offerDiscount,
          discountAmount: discountAmount,
          deliveryCharge: deliveryCharge
        };

        let response = await fetch('/placeOrder', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(paymentDetails)
        });

        let result = await response.text();
        window.location.href = '/successPage';
      } catch (error) {
        console.error("Error handling cash on delivery payment:", error);
      }
    }
  });

  async function handlePayment(response) {
    // Ensure the elements exist before accessing their properties
    let offerDiscountElement = document.getElementById("offerDiscount");
    let discountAmountElement = document.getElementById("discountAmount");
    let deliveryChargeElement = document.getElementById("deliveryCharge");

    // Use nullish coalescing to set a default value if the element is null
    let offerDiscount = offerDiscountElement ? offerDiscountElement.innerText.replace(/[^0-9.]/g, '') : '0';
    let discountAmount = discountAmountElement ? discountAmountElement.innerText.replace(/[^0-9.]/g, '') : '0';
    let deliveryCharge = deliveryChargeElement ? deliveryChargeElement.innerText.replace(/[^0-9.]/g, '') : '0';

    let amountTotal = document.getElementById("totalAmount").innerText.replace(/[^0-9.]/g, '');
    let selectedAddressId = document.getElementById('addressSelect').value;
    let selectedPaymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
    let cartId = document.getElementById('cartId').value;

    try {
      let paymentDetails = {
        addressId: selectedAddressId,
        paymentMethod: selectedPaymentMethod,
        cartId: cartId,
        razorpay_payment_id: response.razorpay_payment_id,
        razorpay_order_id: response.razorpay_order_id,
        razorpay_signature: response.razorpay_signature,
        amountTotal: amountTotal,
        offerDiscount: offerDiscount,
        discountAmount: discountAmount,
        deliveryCharge: deliveryCharge
      };

      let paymentResponse = await fetch('/handlePayment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(paymentDetails)
      });

      if (paymentResponse.ok) {
        window.location.href = '/successPage';
      } else {
        alert("Payment failed. Please try again.");
      }
    } catch (error) {
      console.error("Error handling payment:", error);
      alert('An error occurred while handling payment. Please try again.');
    }
  }

  function handlePaymentFailure(error, orderId, selectedAddressId, paymentMethod, amountTotal) {
    console.error("Payment failed:", error);
    alert('Payment failed. Redirecting to order page.');
    fetch('/handleFailedPayment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        orderId,
        addressId: selectedAddressId,
        paymentMethod: paymentMethod,
        amountTotal: amountTotal,
        error: error
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        window.location.href = '/vieworder';
      } else {
        alert('Failed to handle payment failure. Redirecting to order page.');
        window.location.href = '/vieworder';
      }
    })
    .catch(err => {
      console.error('Error handling payment failure:', err);
      alert('An error occurred while handling payment failure. Redirecting to order page.');
      window.location.href = '/vieworder';
    });
  }

  async function applyCoupon() {
    const couponCode = document.getElementById('couponCodeInput').value;

  
    if (!couponCode) {
    document.getElementById('couponCodeInput').placeholder = 'No coupon code entered. Please enter a coupon code.';
    return;
  }

    const response = await fetch('/applyCoupon', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ couponCode, cartTotal: totalAmount })
    });

    const data = await response.json();

    if (data.message) {
        alert(data.message);
        return;
    }

    discountAmount = data.discountAmount || 0;
    totalAmount = data.total || totalAmount - discountAmount;
    deliveryCharge = totalAmount >= 500 ? 50 : 0;
    totalWithDeliveryCharge = totalAmount + deliveryCharge;

    document.getElementById('appliedCoupon').innerHTML = ` Applied Coupon: ${couponCode}`;
    document.getElementById('discountAmount').innerHTML = ` Discount: ₨ ${discountAmount}`;
    document.getElementById('deliveryCharge').innerHTML = ` Delivery Charge: ₨ ${deliveryCharge}`;
    document.getElementById('totalAmount').innerHTML = ` Total Amount: ₨ ${totalWithDeliveryCharge}`;
    document.getElementById('removeCouponButton').style.display = 'block';
    document.getElementById('couponCodeInput').disabled = true;
    document.getElementById('applyCouponBtn').disabled = true;
    document.getElementById('couponSuccessMessage').style.display = 'block';
}

function removeCoupon() {
    totalAmount += discountAmount;
    discountAmount = 0;
    deliveryCharge = totalAmount >= 500 ? 50 : 0;
    totalWithDeliveryCharge = totalAmount + deliveryCharge;

    document.getElementById('appliedCoupon').innerHTML = ' Applied Coupon: None';
    document.getElementById('discountAmount').innerHTML = ' Discount: ₨ 0';
    document.getElementById('deliveryCharge').innerHTML = ` Delivery Charge: ₨ ${deliveryCharge}`;
    document.getElementById('totalAmount').innerHTML = ` Total Amount: ₨ ${totalWithDeliveryCharge}`;
    document.getElementById('removeCouponButton').style.display = 'none';
    document.getElementById('couponCodeInput').value = '';
    document.getElementById('couponCodeInput').disabled = false;
    document.getElementById('applyCouponBtn').disabled = false;
    document.getElementById('couponSuccessMessage').style.display = 'none';
}

</script>


  <script>
    document.addEventListener('DOMContentLoaded', function () {
      let check = true;

      function validateText(inputFieldId, errorMessageId) {
        const inputField = document.getElementById(inputFieldId);
        const errorMessageElement = document.getElementById(errorMessageId);
        errorMessageElement.textContent = '';
        const value = inputField.value.trim();

        if (value === "") {
          check = false;
          errorMessageElement.textContent = 'This field cannot be empty.';
        } else if (!/^[a-zA-Z\s]*$/.test(value)) {
          check = false;
          errorMessageElement.textContent = 'Please enter a valid text.';
        }
      }

      function validateNumber(inputFieldId, errorMessageId) {
        const inputField = document.getElementById(inputFieldId);
        const errorMessageElement = document.getElementById(errorMessageId);
        errorMessageElement.textContent = '';
        const value = inputField.value.trim().replace(/\s/g, '');

        if (value === "") {
          check = false;
          errorMessageElement.textContent = 'This field cannot be empty.';
        } else if (!/^\d*$/.test(value)) {
          check = false;
          errorMessageElement.textContent = 'Please enter a valid number without spaces.';
        }
      }

      function validatePincode(inputFieldId, errorMessageId) {
        const inputField = document.getElementById(inputFieldId);
        const errorMessageElement = document.getElementById(errorMessageId);
        errorMessageElement.textContent = '';
        const value = inputField.value.trim();

        if (value === "") {
          check = false;
          errorMessageElement.textContent = 'This field cannot be empty.';
        } else if (!/^\d{6}$/.test(value)) {
          check = false;
          errorMessageElement.textContent = 'Pincode must be 6 digits.';
        }
      }

      document.getElementById('mobile').addEventListener('input', function () {
        validateNumber('mobile', 'mobileValidation');
      });

      document.getElementById('pincode').addEventListener('input', function () {
        validatePincode('pincode', 'pincodeValidation');
      });

      document.getElementById('name').addEventListener('input', function () {
        validateText('name', 'nameValidation');
      });

      document.getElementById('address').addEventListener('input', function () {
        const inputField = document.getElementById('address');
        const errorMessageElement = document.getElementById('addressValidation');
        errorMessageElement.textContent = '';
        if (inputField.value.trim() === "") {
          check = false;
          errorMessageElement.textContent = 'Address cannot be empty.';
        }
      });

      document.getElementById('district').addEventListener('input', function () {
        validateText('district', 'districtValidation');
      });

      document.getElementById('state').addEventListener('input', function () {
        validateText('state', 'stateValidation');
      });

      function validateFormAddress() {
        check = true;
        validateText('name', 'nameValidation');
        validateNumber('mobile', 'mobileValidation');
        validatePincode('pincode', 'pincodeValidation');
        const addressField = document.getElementById('address');
        if (addressField.value.trim() === "") {
          check = false;
          document.getElementById('addressValidation').textContent = 'Address cannot be empty.';
        }
        validateText('district', 'districtValidation');
        validateText('state', 'stateValidation');
        return check;
      }

      function submitAddressForm(event) {
        event.preventDefault();
        if (validateFormAddress()) {
          $.ajax({
            url: '/addaddresss',
            type: 'POST',
            data: $('#addressForm').serialize(),
            success: function (response) {
              if (response.success) {
                const newAddress = response.newAddress;
                const newOption = `<option value="${newAddress._id}"> ${newAddress.name} - ${newAddress.address}, ${newAddress.state}, ${newAddress.pincode} </option>`;
                $('#addressSelect').append(newOption);
                $('#addressModal').modal('hide');
                $('#addressForm')[0].reset();
                location.reload(); // Refresh the page to update the checkout details
              } else {
                let errorMessage = '';
                if (response.errors) {
                  const errors = response.errors;
                  if (Array.isArray(errors)) {
                    errorMessage = errors.join('<br>');
                  } else {
                    errorMessage = errors;
                  }
                } else {
                  errorMessage = 'An error occurred. Please try again.';
                }
                alert('Error: ' + errorMessage);
              }
            },
            error: function (xhr, status, error) {
              alert('An error occurred: ' + error);
            }
          });
        }
      }

      document.getElementById('addressForm').addEventListener('submit', submitAddressForm);
    });
  </script>



  <script>
    $(".js-select2").each(function () {
      $(this).select2({
        minimumResultsForSearch: 20,
        dropdownParent: $(this).next('.dropDownSelect2')
      });
    })
  </script>


  

  <script>

    // function validateForm() {
    //   const selectedAddress = document.getElementById('addressSelect').value;
   
    // Update selected address container when a new address is selected from the dropdown menu
    $('#addressSelect').on('change', function () {
      const selectedAddressId = $(this).val();
      const selectedAddress = addresses.find(address => address._id === selectedAddressId);
      const selectedAddressName = selectedAddress.name;
      const selectedAddressDetails = `${selectedAddress.address}, ${selectedAddress.state}, ${selectedAddress.pincode}`;
      $('#selectedAddressContainer').html(`
    <p>
      <strong>${selectedAddressName}</strong><br />
      ${selectedAddressDetails}
    </p>
    <input type="hidden" id="selectedAddress" name="selectedAddress" value="${selectedAddressId}" />
  `);
    });

    // Update selected address container when a new address is selected from the modal
    $('#addressModal').on('click', '.modal-address-radio', function () {
      const selectedAddressId = $(this).val();
      const selectedAddress = addresses.find(address => address._id === selectedAddressId);
      const selectedAddressName = selectedAddress.name;
      const selectedAddressDetails = `${selectedAddress.address}, ${selectedAddress.state}, ${selectedAddress.pincode}`;
      $('#selectedAddressContainer').html(`
    <p>
      <strong>${selectedAddressName}</strong><br />
      ${selectedAddressDetails}
    </p>
    <input type="hidden" id="selectedAddress" name="selectedAddress" value="${selectedAddressId}" />
  `);
      $('#addressModal').modal('hide');
    });

  </script>

  <script>
    window.addresses = <% - JSON.stringify(addresses) %>;
  </script>


  <script>
    // Fetch wallet balance from the server
    fetch("/getWalletBalance")
      .then(response => response.json())
      .then(data => {
        // Update wallet balance in the UI
        // document.getElementById("walletBalance").innerText = data.balance;
      })
      .catch(error => {
        console.error("Error fetching wallet balance:", error);
      });
  </script>



  <script>
    $('.js-pscroll').each(function () {
      $(this).css('position', 'relative');
      $(this).css('overflow', 'hidden');
      var ps = new PerfectScrollbar(this, {
        wheelSpeed: 1,
        scrollingThreshold: 1000,
        wheelPropagation: false,
      });

      $(window).on('resize', function () {
        ps.update();
      })
    });
  </script>

  <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
  <script src="vendor/animsition/js/animsition.min.js"></script>
  <script src="vendor/bootstrap/js/popper.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="vendor/select2/select2.min.js"></script>
  <script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
  <script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="js/main.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

</body>

</html>